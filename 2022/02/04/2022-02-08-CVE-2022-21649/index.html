<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="DescriptionThe Convos is an open source multi-user chat that runs in a web browser. Characters starting with “https:&#x2F;&#x2F;” in the chat window create “a” tag. Stored XSS vulnerability using onfo">
<meta property="og:type" content="article">
<meta property="og:title" content="CVE-2022-21649">
<meta property="og:url" content="https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/index.html">
<meta property="og:site_name" content="POCAS">
<meta property="og:description" content="DescriptionThe Convos is an open source multi-user chat that runs in a web browser. Characters starting with “https:&#x2F;&#x2F;” in the chat window create “a” tag. Stored XSS vulnerability using onfo">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://github.com/blogpocas/DATA/blob/main/BB/convos-chat/Stored%20XSS%202/1.png?raw=true">
<meta property="article:published_time" content="2022-02-04T18:35:45.000Z">
<meta property="article:modified_time" content="2022-03-24T03:19:37.056Z">
<meta property="article:author" content="POCAS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/blogpocas/DATA/blob/main/BB/convos-chat/Stored%20XSS%202/1.png?raw=true">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>CVE-2022-21649</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.1.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2022/02/04/2022-02-08-CVE-2022-21650/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2022/02/03/2022-02-07-CVE-2022-0509/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&text=CVE-2022-21649"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&title=CVE-2022-21649"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&is_video=false&description=CVE-2022-21649"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CVE-2022-21649&body=Check out this article: https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&title=CVE-2022-21649"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&title=CVE-2022-21649"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&title=CVE-2022-21649"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&title=CVE-2022-21649"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&name=CVE-2022-21649&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&t=CVE-2022-21649"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Description"><span class="toc-number">1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Proof-of-Concept"><span class="toc-number">2.</span> <span class="toc-text">Proof of Concept</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reporting-Timeline"><span class="toc-number">3.</span> <span class="toc-text">Reporting Timeline</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reference"><span class="toc-number">4.</span> <span class="toc-text">Reference</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        <a href="/">CVE-2022-21649</a>
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">POCAS</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-02-04T18:35:45.000Z" itemprop="datePublished">2022-02-04</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>The <a target="_blank" rel="noopener" href="https://github.com/convos-chat/convos">Convos</a> is an open source multi-user chat that runs in a web browser. Characters starting with “https:&#x2F;&#x2F;” in the chat window create “a” tag. Stored XSS vulnerability using onfocus and autofocus occurs because escaping exists for “&lt;” or “&gt;” but escaping for double quarter does not exist.</p>
<style>
    .myvideo {
        width: auto;
        max-width: 100%;
        height: auto;
    }
</style>
<img src="https://github.com/blogpocas/DATA/blob/main/BB/convos-chat/Stored%20XSS%202/1.png?raw=true" class="myvideo">
If you look at the picture above, you can see that URL formatting exists in Text Formatting. I thought this was a very nice XSS gadget.

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  <span class="title function_">_mdLink</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> re = <span class="variable constant_">RE</span>.<span class="property">mdLink</span> || (<span class="variable constant_">RE</span>.<span class="property">mdLink</span> = <span class="title class_">XRegExp</span>(<span class="string">&#x27;\\[ ([a-zA-Z][^\\]]+) \\] \\( ([^)]+) \\)&#x27;</span>, <span class="string">&#x27;gx&#x27;</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">XRegExp</span>.<span class="title function_">replace</span>(str, re, <span class="function">(<span class="params">all, text, href</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> scheme = href.<span class="title function_">match</span>(<span class="regexp">/^\s*(\w+):/</span>) || [<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>];</span><br><span class="line">      <span class="keyword">if</span> (scheme[<span class="number">1</span>] &amp;&amp; [<span class="string">&#x27;http&#x27;</span>, <span class="string">&#x27;https&#x27;</span>, <span class="string">&#x27;mailto&#x27;</span>].<span class="title function_">indexOf</span>(scheme[<span class="number">1</span>]) == -<span class="number">1</span>) <span class="keyword">return</span> all; <span class="comment">// Avoid XSS links</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_state</span>.<span class="property">md</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">const</span> first = href.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">const</span> target = [<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;#&#x27;</span>].<span class="title function_">indexOf</span>(first) != -<span class="number">1</span> ? <span class="string">&#x27;&#x27;</span> : <span class="string">&#x27; target=&quot;_blank&quot;&#x27;</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;&lt;a href=&quot;&#x27;</span> + route.<span class="title function_">urlFor</span>(href) + <span class="string">&#x27;&quot;&#x27;</span> + target + <span class="string">&#x27;&gt;&#x27;</span> + text + <span class="string">&#x27;&lt;/a&gt;&#x27;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// https://github.com/convos-chat/convos/blob/main/assets/store/I18N.js#L158L168</span></span><br></pre></td></tr></table></figure>
<p>I was able to find the code for the _mdLink() method on github. Look at the code. You can see that the value of route.urlFor(href) is passed as the value of href without being URL encoded.</p>
<p>What does this mean? You can escape the href attribute using double quotes. After that, you can insert an XSS PoC using the autofocus and onfocus properties.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;asdf&quot;</span> <span class="attr">onfocus</span>=<span class="string">&quot;alert(document.domain)&quot;</span> <span class="attr">autofocus</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>You can make it just like above. In the above HTML code, onfocus is executed immediately by autofocus! In other words, the XSS vulnerability can be exploited by using the logic to create URL links in chat rooms.</p>
<hr>
<h3 id="Proof-of-Concept"><a href="#Proof-of-Concept" class="headerlink" title="Proof of Concept"></a>Proof of Concept</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. Open the https://demo.convos.chat/login and Login as to above account</span><br><span class="line">2. Go to https://demo.convos.chat/chat/irc-demo-irc-convos/&lt;chat room name&gt;</span><br><span class="line">3. In chat room. Enter the https://x.&quot;//onfocus=&quot;alert(document.domain)&quot;//autofocus=&quot;&quot; b=&quot;</span><br><span class="line"></span><br><span class="line">Video : https://www.youtube.com/watch?v=L1Be-D-GVmQ</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Reporting-Timeline"><a href="#Reporting-Timeline" class="headerlink" title="Reporting Timeline"></a>Reporting Timeline</h3><ul>
<li>2021-12-30 00h 53m : Reported this issue via the <a target="_blank" rel="noopener" href="https://www.huntr.dev/">huntr</a></li>
<li>2021-12-31 16h 47m : Validated this issue by <a target="_blank" rel="noopener" href="https://github.com/jhthorsen">jhthorsen</a></li>
<li>2021-12-31 16h 48m : Patched this issue by <a target="_blank" rel="noopener" href="https://github.com/jhthorsen">jhthorsen</a></li>
<li>2022-01-05 05h 28m : Assigned a CVE-2022-21649 via Github Staff</li>
</ul>
<hr>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/convos-chat/convos/commit/86b2193de375005ba71d9dd53843562c6ac1847c">Github Commit</a></li>
<li><a target="_blank" rel="noopener" href="https://www.huntr.dev/bounties/4532a0ac-4e7c-4fcf-9fe3-630e132325c0/">Huntr</a></li>
<li><a target="_blank" rel="noopener" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-21649">Mitre</a></li>
<li><a target="_blank" rel="noopener" href="https://nvd.nist.gov/vuln/detail/CVE-2022-21649">NVD</a></li>
</ul>
<hr>
<script>
  link = document.createElement('link');
  link.setAttribute('rel', 'shortcut icon');
  link.setAttribute('type','image/x-icon');
  link.setAttribute('href','https://github.com/convos-chat.png');
  head = document.getElementsByTagName('head');
  head[0].appendChild(link)
</script>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Description"><span class="toc-number">1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Proof-of-Concept"><span class="toc-number">2.</span> <span class="toc-text">Proof of Concept</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reporting-Timeline"><span class="toc-number">3.</span> <span class="toc-text">Reporting Timeline</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reference"><span class="toc-number">4.</span> <span class="toc-text">Reference</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&text=CVE-2022-21649"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&title=CVE-2022-21649"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&is_video=false&description=CVE-2022-21649"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CVE-2022-21649&body=Check out this article: https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&title=CVE-2022-21649"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&title=CVE-2022-21649"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&title=CVE-2022-21649"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&title=CVE-2022-21649"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&name=CVE-2022-21649&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://blog.pocas.kr/2022/02/04/2022-02-08-CVE-2022-21649/&t=CVE-2022-21649"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2022
    POCAS
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
